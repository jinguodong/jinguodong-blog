<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="guodong.j" />
    <title>Custom Container View Controller | guodong.j</title>
    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAD/APr59wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiIiIiAAAiIiIiIiIAACIiIiIiIgERERERERIiAREREREREiIBERERERESIgERIiIiERIiAREiIiIREiIBESIhERESIgERIiERERIiAREiIiIiIiIBESIiIiIiIgERIiIiIiIiAREREREREAABEREREREQAAERERERERAADgAQAA4AEAAOABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAA8AAAAPAAAADwAA" rel="icon" type="image/x-icon" />
    <link href="/feed/" rel="alternate" title="guodong.j" type="application/atom+xml" />
    
    <link rel="stylesheet" href="/jinguodong-blog/media/css/highlight.css">
    <link href='/jinguodong-blog/media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='/jinguodong-blog/media/webfonts/ss-standard.css' rel='stylesheet'>
    <link href="/jinguodong-blog/media/css/screen.css" rel="stylesheet">

    <script type="text/javascript" src="/jinguodong-blog/media/js/jquery-1.7.1.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/jinguodong-blog/" class="ss-icon" title="Go to homepage">home</a>
          <a href="/jinguodong-blog/categories" class="ss-icon" title="Category" >list</a>
          <a href="/jinguodong-blog/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/jinguodong-blog/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/jinguodong-blog/about" class="ss-icon" title="About" >user</a>
          <a href="/jinguodong-blog/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>Custom Container View Controller</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<p>ä»€ä¹ˆæ˜¯Container View Controller?è‹¹æœæ–‡æ¡£æ˜¯è¿™ä¹ˆæè¿°çš„:</p>

<pre><code>A container view controller contains content owned by other view controllers.
</code></pre>

<p>ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªView Controlleræ˜¾ç¤ºçš„æŸéƒ¨åˆ†å†…å®¹å±äºå¦ä¸€ä¸ªView Controllerï¼Œé‚£ä¹ˆè¿™ä¸ªView Controllerå°±æ˜¯ä¸€ä¸ªContainerï¼Œæ¯”å¦‚UIKitä¸­çš„UINavigationControllerï¼ŒUITabBarControllerã€‚ <br/>
åœ¨iOS 5ä¹‹å‰è‹¹æœæ˜¯ä¸å…è®¸å‡ºç°è‡ªå®šä¹‰çš„Containerçš„ ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åˆ›å»ºçš„ä¸€ä¸ªView Controllerçš„viewä¸èƒ½åŒ…å«å¦ä¸€ä¸ªView Controllerçš„viewï¼Œè¿™å¯¹äºé€»è¾‘å¤æ‚çš„ç•Œé¢æ¥è¯´ï¼Œä¸æ˜“äºåŠŸèƒ½æ‹†åˆ†ã€‚ä¹Ÿè®¸æ›¾ç»ä½ ä¸ºäº†æŸä¸ªå…¬ç”¨çš„æ˜¾ç¤ºé€»è¾‘ï¼Œç›´æ¥å°†æŸä¸ªView Controllerçš„viewæ·»åŠ åˆ°å¦ä¸€ä¸ªView Controllerçš„viewä¸Šï¼Œç„¶åå‘ç°å¯ä»¥æ­£å¸¸æ˜¾ç¤ºå’Œä½¿ç”¨ï¼Œä½†å®é™…ä¸Šè¿™ç§è¡Œä¸ºæ˜¯éå¸¸å±é™©çš„ã€‚</p>

<p>iOS 5.0 å¼€å§‹æ”¯æŒCustom Container View Controllerï¼Œå¼€æ”¾äº†ç”¨äºæ„å»ºè‡ªå®šä¹‰Containerçš„æ¥å£ã€‚å¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„Containerï¼Œé‚£ä¹ˆæœ‰ä¸€äº›æ¦‚å¿µè¿˜å¾—å¼„æ¸…æ¥šã€‚Containerçš„ä¸»è¦èŒè´£å°±æ˜¯ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªChild View Controllerçš„å±•ç¤ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦ä¼ é€’æ˜¾ç¤ºä»¥åŠæ—‹è½¬ç›¸å…³çš„å›è°ƒã€‚å…¶å®æ˜¾ç¤ºæˆ–è€…æ—‹è½¬çš„å›è°ƒçš„è§¦å‘çš„æºå¤´æ¥è‡ªäºwindow,ä¸€ä¸ªappé¦–å…ˆæœ‰ä¸€ä¸ªä¸»windowï¼Œåˆå§‹åŒ–çš„æ—¶å€™éœ€è¦ç»™è¿™ä¸ªä¸»windowæŒ‡å®šä¸€ä¸ªrootViewControllerï¼Œwindowä¼šå°†æ˜¾ç¤ºç›¸å…³çš„å›è°ƒ(viewWillAppear:, viewWillDisappear:, viewDidAppear:, or viewDidDisappear: )ä»¥åŠæ—‹è½¬ç›¸å…³çš„å›è°ƒ(willRotateToInterfaceOrientation:duration:
,willAnimateRotationToInterfaceOrientation:duration:,
didRotateFromInterfaceOrientation:)ä¼ é€’ç»™rootViewControllerã€‚rootViewControlleréœ€è¦å†å°†è¿™äº›callbacksçš„è°ƒç”¨ä¼ é€’ç»™å®ƒçš„Child View Controllersã€‚</p>

<h3>ä¸€.çˆ¶å­å…³ç³»èŒƒå¼</h3>

<p>å®ç°ä¸€ä¸ªCustom Container View Controllerå¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº‹æƒ…ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šçˆ¶å­å…³ç³»çš„å»ºç«‹ä»¥åŠçˆ¶å­å…³ç³»çš„è§£é™¤ã€‚å¦‚æœpVCå°†cVCçš„viewæ·»åŠ ä¸ºè‡ªå·±çš„subviewï¼Œé‚£ä¹ˆcVCå¿…é¡»ä¸ºpVCçš„Child View Controllerï¼Œè€Œåè¿‡æ¥åˆ™ä¸ä¸€å®šæˆç«‹ï¼Œæ¯”å¦‚UINavigationControllerï¼Œä¸€ä¸ªView Controllerè¢«pushè¿›æ¥åä¾¿å’ŒnavigationControllerå»ºç«‹çˆ¶å­å…³ç³»äº†,ä½†æ˜¯åªæœ‰æœ€ä¸Šé¢çš„View Controller æ˜¯æ˜¾ç¤ºç€çš„ï¼Œåº•ä¸‹çš„View Controllerçš„viewåˆ™è¢«ç§»å‡ºäº†å®¹å™¨çš„viewçš„æ˜¾ç¤ºå±‚çº§ï¼Œå½“ä¸€ä¸ªView Controllerè¢«popä¹‹åï¼Œä¾¿å’ŒnavigationControllerè§£é™¤äº†çˆ¶å­å…³ç³»äº†ã€‚</p>

<p><strong>å±•ç¤ºä¸€ä¸ªåä¸ºcontentçš„child view controller</strong>ï¼š</p>

<pre><code> [self addChildViewController:content];  //1
 content.view.frame = [self frameForContentController]; 
 [self.view addSubview:self.currentClientView]; //2
 [content didMoveToParentViewController:self]; //3
</code></pre>

<p>1.å°†contentæ·»åŠ ä¸ºchild view controllerï¼ŒaddChildViewController:æ¥å£å»ºç«‹äº†é€»è¾‘ä¸Šçš„çˆ¶å­å…³ç³»ï¼Œå­å¯ä»¥é€šè¿‡parentViewControllerï¼Œè®¿é—®å…¶çˆ¶VCï¼ŒaddChildViewController:æ¥å£çš„é€»è¾‘ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨ <code>[content willMoveToParentViewController:self];</code><br/>
2.å»ºç«‹çˆ¶å­å…³ç³»åï¼Œä¾¿æ˜¯å°†contentçš„viewåŠ å…¥åˆ°çˆ¶VCçš„view hierarchyä¸Šï¼ŒåŒæ—¶è¦å†³å®šçš„æ˜¯ contentçš„viewæ˜¾ç¤ºçš„åŒºåŸŸèŒƒå›´ã€‚ <br/>
3.è°ƒç”¨childçš„ didMoveToParentViewController: ï¼Œä»¥é€šçŸ¥childï¼Œå®Œæˆäº†çˆ¶å­å…³ç³»çš„å»ºç«‹</p>

<p><strong>ç§»é™¤ä¸€ä¸ªchild view controller</strong>ï¼š</p>

<pre><code> [content willMoveToParentViewController:nil]; //1
 [content.view removeFromSuperview]; //2
 [content removeFromParentViewController]; //3
</code></pre>

<p>1.é€šçŸ¥childï¼Œå³å°†è§£é™¤çˆ¶å­å…³ç³»ï¼Œä»è¯­ä¹‰ä¸Šä¹Ÿå¯ä»¥çœ‹å‡º childçš„parentå³å°†ä¸ºnil<br/>
2.å°†childçš„viewä»çˆ¶VCçš„viewçš„hierarchyä¸­ç§»é™¤ <br/>
3.é€šè¿‡removeFromParentViewControllerçš„è°ƒç”¨çœŸæ­£çš„è§£é™¤å…³ç³»ï¼ŒremoveFromParentViewControllerä¼šè‡ªåŠ¨è°ƒç”¨ [content didMoveToParentViewController:nil]</p>

<h3>äºŒ.appearance callbacksçš„ä¼ é€’</h3>

<p>ä¸Šé¢çš„å®ç°ä¸­æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ²¡çœ‹åˆ°é‚£äº›appearance callbacksæ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Œç­”æ¡ˆå°±æ˜¯appearance callbacksé»˜è®¤æƒ…å†µä¸‹æ˜¯è‡ªåŠ¨è°ƒç”¨çš„ï¼Œè‹¹æœæ¡†æ¶åº•å±‚å¸®ä½ å®ç°å¥½äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸Šé¢çš„addSubviewçš„æ—¶å€™ï¼Œåœ¨subviewçœŸæ­£åŠ åˆ°çˆ¶viewä¹‹å‰ï¼Œchildçš„viewWillAppearå°†è¢«è°ƒç”¨ï¼ŒçœŸæ­£è¢«addåˆ°çˆ¶viewä¹‹åï¼ŒviewDidAppearä¼šè¢«è°ƒç”¨ã€‚ç§»é™¤çš„è¿‡ç¨‹ä¸­viewWillDisappearï¼ŒviewDidDisappearçš„è°ƒç”¨è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚<br/>
æœ‰æ—¶å€™è‡ªåŠ¨çš„appearance callbacksçš„è°ƒç”¨å¹¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ¯”å¦‚child viewçš„å±•ç¤ºæœ‰ä¸€ä¸ªåŠ¨ç”»çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸æƒ³viewDidAppearçš„è°ƒç”¨åœ¨addSubviewçš„æ—¶å€™è¿›è¡Œï¼Œè€Œæ˜¯ç­‰å±•ç¤ºåŠ¨ç”»ç»“æŸåå†è°ƒç”¨viewDidAppearã€‚ä¹Ÿè®¸ä½ å¯èƒ½ä¼šæåˆ° <code>transitionFromViewController:toViewController:duration:options:animations:completion:</code> è¿™ä¸ªæ–¹æ³•ï¼Œä¼šå¸®ä½ è‡ªåŠ¨å¤„ç†viewçš„addå’Œremoveï¼Œä»¥åŠæ”¯æŒanimations blockï¼Œä¹Ÿèƒ½å¤Ÿä¿è¯åœ¨åŠ¨ç”»å¼€å§‹å‰è°ƒç”¨willAppearæˆ–è€…willDisappearï¼Œåœ¨è°ƒç”¨ç»“æŸçš„æ—¶å€™è°ƒç”¨didAppearï¼ŒdidDisappearï¼Œä½†æ˜¯æ­¤æ–¹å¼ä¹Ÿå­˜åœ¨å±€é™æ€§ï¼Œå¿…é¡»æ˜¯ä¸¤ä¸ªæ–°è€å­VCçš„åˆ‡æ¢ï¼Œéƒ½ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºè¦ä¿è¯æ–°è€VCæ‹¥æœ‰åŒä¸€ä¸ªparentViewControllerï¼Œä¸”å‚æ•°ä¸­çš„viewControllerä¸èƒ½æ˜¯ç³»ç»Ÿä¸­çš„containerï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯UINavigationControlleræˆ–è€…UITabbarControllerç­‰ã€‚  <br/>
æ‰€ä»¥å¦‚æœä½ è¦è‡ªå·±å†™ä¸€ä¸ªç•Œé¢å®¹å™¨å¾€å¾€ç”¨ä¸äº†appearence callbacksè‡ªåŠ¨è°ƒç”¨çš„ç‰¹æ€§ï¼Œéœ€è¦å°†æ­¤ç‰¹æ€§å…³é—­ï¼Œç„¶åè‡ªå·±å»ç²¾ç¡®æ§åˆ¶appearance callbacksçš„è°ƒç”¨æ—¶æœºã€‚ <br/>
é‚£å¦‚ä½•å…³é—­appearance callbacksçš„è‡ªåŠ¨ä¼ é€’çš„ç‰¹æ€§å‘¢ï¼Ÿåœ¨iOS 5.xä¸­ä½ éœ€è¦è¦†ç›–<code>automaticallyForwardAppearanceAndRotationMethodsToChildViewControllers</code>,ç„¶åè¿”å›NO,iOS6+ä¸­ä½ éœ€è¦è¦†ç›– <code>shouldAutomaticallyForwardAppearanceMethods</code>æ–¹æ³•å¹¶è¿”å›NO. <br/>
æ‰‹åŠ¨ä¼ é€’çš„æ—¶å€™ä½ å¹¶ä¸èƒ½ç›´æ¥å»è°ƒç”¨child çš„viewWillAppearæˆ–è€…viewDidAppearè¿™äº›æ–¹æ³•ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨ <code>beginAppearanceTransition:animated:</code>å’Œ<code>endAppearanceTransition</code>æ¥å£æ¥é—´æ¥è§¦å‘é‚£äº›appearance callbacksï¼Œä¸”beginå’Œendå¿…é¡»æˆå¯¹å‡ºç°ã€‚ <br/>
<code>[content beginAppearanceTransition:YES animated:animated]</code>è§¦å‘contentçš„viewWillAppearï¼Œ<code>[content beginAppearanceTransition:NO animated:animated]</code>è§¦å‘contentçš„viewWillDisappearï¼Œå’Œä»–ä»¬é…å¥—çš„[content endAppearanceTransition]åˆ†åˆ«è§¦å‘viewDidAppearå’ŒviewDidDisappearã€‚  (AppearanceTransitionçš„è¿™ä¸¤ä¸ªæ¥å£ä¹‹å‰åœ¨è‹¹æœæè¿°çš„æ–‡æ¡£ä¸­ä¸€å¼€å§‹è¿˜å­˜åœ¨é—®é¢˜ï¼Œå› ä¸ºæ–‡æ¡£ä¸­ä¸€å¼€å§‹è¯´æ˜¯iOS5ä¸æ”¯æŒè¿™ä¸¤ä¸ªæ¥å£ï¼Œå…¶å®æ˜¯æ”¯æŒçš„ï¼Œåæ¥è‹¹æœçº æ­£äº†æ–‡æ¡£ä¸­çš„è¿™ä¸ªé”™è¯¯)ã€‚</p>

<h3>ä¸‰.rotation callbacksçš„ä¼ é€’</h3>

<p>ä¹Ÿè®¸åœ¨iPhoneä¸Šå¾ˆå°‘è¦å…³å¿ƒçš„å±å¹•æ—‹è½¬é—®é¢˜çš„ï¼Œä½†æ˜¯å¤§å±å¹•çš„iPadä¸Šå°±ä¸åŒäº†ï¼Œå¾ˆå¤šæ—¶å€™ä½ éœ€è¦å…³å¿ƒæ¨ªç«–å±ã€‚rotation callbacks ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦å…³å¿ƒä¸‰ä¸ªæ–¹æ³•
<code>willRotateToInterfaceOrientation:duration:</code>åœ¨æ—‹è½¬å¼€å§‹å‰ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›<code>willAnimateRotationToInterfaceOrientation:duration:</code> æ­¤æ–¹æ³•çš„è°ƒç”¨åœ¨æ—‹è½¬åŠ¨ç”»blockçš„å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æ­¤æ–¹æ³•ä¸­çš„ä»£ç ä¼šä½œä¸ºæ—‹è½¬animation blockçš„ä¸€éƒ¨åˆ†ï¼›<code>didRotateFromInterfaceOrientation:</code>æ­¤æ–¹æ³•ä¼šåœ¨æ—‹è½¬ç»“æŸæ—¶è¢«è°ƒç”¨ã€‚è€Œä½œä¸ºview controller container å°±è¦è‚©è´Ÿèµ·æ—‹è½¬çš„å†³ç­–ä»¥åŠæ—‹è½¬çš„callbacksçš„ä¼ é€’çš„è´£ä»»ã€‚</p>

<p>å½“ä½¿ç”¨æ¡†æ¶çš„è‡ªåŠ¨ä¼ é€’çš„ç‰¹æ€§çš„æ—¶å€™ï¼Œä½œä¸ºå®¹å™¨çš„view controller ä¼šè‡ªåŠ¨
å°†è¿™äº›æ–¹æ³•ä¼ é€’ç»™æ‰€æœ‰çš„child viewcontrollersï¼Œ æœ‰æ—¶å€™ä½ å¯èƒ½ä¸éœ€è¦ä¼ é€’ç»™æ‰€æœ‰çš„child viewcontrollerï¼Œè€Œåªéœ€è¦ä¼ é€’ç»™æ­£åœ¨æ˜¾ç¤ºçš„child viewcontrollerï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ç¦æ‰æ—‹è½¬å›è°ƒè‡ªåŠ¨ä¼ é€’çš„ç‰¹æ€§ï¼Œå’Œç¦æ‰appearance callbacksè‡ªåŠ¨ä¼ é€’çš„æ–¹å¼ç±»ä¼¼ï¼Œéœ€è¦è¦†ç›–ç›¸å…³æ–¹æ³•å¹¶è¿”å›NOï¼Œåœ¨iOS5.xä¸­ï¼Œappearance callbackså’Œrotation callbacksç¦æ‰æ˜¯å…¬ç”¨ä¸€ä¸ªæ–¹æ³•çš„å°±æ˜¯ <code>automaticallyForwardAppearanceAndRotationMethodsToChildViewControllers</code>ï¼Œåœ¨iOS6ä¹‹ååˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„æ–¹æ³•ï¼Œæ—‹è½¬çš„åˆ™æ˜¯ <code>shouldAutomaticallyForwardRotationMethods</code>ã€‚ <br/>
æ—‹è½¬ç›¸å…³çš„é™¤äº†ä¸Šé¢çš„å‡ ä¸ªrotation callbacksæ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªååˆ†é‡è¦çš„æ¦‚å¿µï¼Œå°±æ˜¯ä¸€ä¸ªview controllerå¯ä»¥å†³å®šè‡ªå·±æ˜¯å¦æ”¯æŒå½“å‰å–å‘çš„æ—‹è½¬ï¼Œè¿™ä¸ªä¸œè¥¿åœ¨iOS6å‰åçš„å®ç°æ–¹å¼è¿˜ä¸ä¸€æ ·ï¼ŒiOS6ä¹‹å‰ä½¿ç”¨çš„æ–¹æ³•æ˜¯ <code>shouldAutorotateToInterfaceOrientation</code>ï¼Œå°±æ˜¯ä¸€ä¸ªview controllerè¦†ç›–æ­¤æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„å³å°†æ—‹è½¬çš„å–å‘çš„å‚æ•°ï¼Œæ¥å†³å®šæ˜¯å¦æ—‹è½¬ã€‚è€ŒiOS6.0ä¹‹åçš„å®ç°åˆ™æ‹†åˆ†æˆä¸¤ä¸ªæ–¹æ³• <code>shouldAutorotate</code>å’Œ<code>supportedInterfaceOrientations</code>,å‰è€…å†³å®šå†æ—‹è½¬çš„æ—¶å€™æ˜¯å¦å»æ ¹æ®<code>supportedInterfaceOrientations</code>æ‰€æ”¯æŒçš„å–å‘æ¥å†³å®šæ˜¯å¦æ—‹è½¬ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ<code>shouldAutorotate</code>è¿”å›YESçš„æ—¶å€™ï¼Œæ‰ä¼šå»è°ƒç”¨<code>supportedInterfaceOrientations</code>æ£€æŸ¥å½“å‰view controlleræ”¯æŒçš„å–å‘ï¼Œå¦‚æœå½“å‰å–å‘åœ¨æ”¯æŒçš„èŒƒå›´ä¸­ï¼Œåˆ™è¿›è¡Œæ—‹è½¬ï¼Œå¦‚æœä¸åœ¨åˆ™ä¸æ—‹è½¬ï¼›è€Œå½“<code>shouldAutorotate</code>è¿”å›NOçš„æ—¶å€™ï¼Œåˆ™æ ¹æœ¬ä¸ä¼šå»ç®¡<code>supportedInterfaceOrientations</code>è¿™ä¸ªæ–¹æ³•ï¼Œåæ­£æ˜¯ä¸ä¼šè·Ÿç€è®¾å¤‡æ—‹è½¬å°±æ˜¯äº†ã€‚ <br/>
è€Œä½œä¸ºç•Œé¢å®¹å™¨ä½ è¦æ³¨æ„çš„å°±æ˜¯ä½ éœ€è¦å»æ£€æŸ¥ä½ çš„child view controllerï¼Œæ£€æŸ¥ä»–ä»¬å¯¹æ¨ªç«–å±çš„æ”¯æŒæƒ…å†µï¼Œä»¥ä¾¿å®¹å™¨è‡ªå·±å†³ç­–åœ¨æ¨ªç«–å±æ—‹è½¬æ—¶å€™æ˜¯å¦æ”¯æŒå½“å‰çš„å–å‘ï¼Œå’Œä¸Šé¢çš„callbacksä¼ é€’çš„æ–¹å‘ç›¸æ¯”ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªåå‘çš„ä¼ é€’ã€‚</p>

<h3>å››.åˆ›å»ºè‡ªå·±çš„å®¹å™¨åŸºç±»</h3>

<p>å½“ä½ éœ€è¦æ„å»ºè‡ªå·±çš„Container View Controllerçš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªContaineréƒ½ä¼šæœ‰ä¸€äº›ç›¸åŒçš„é€»è¾‘ï¼Œå¦‚æœä½ æ¯ä¸€ä¸ªéƒ½å†™ä¸€éä¼šå­˜åœ¨å¾ˆå¤šé‡å¤ä»£ç ï¼Œæ‰€ä»¥æœ€å¥½ä½ åˆ›å»ºä¸€ä¸ªContaineråŸºç±»ï¼Œå»å®ç°å®¹å™¨éƒ½éœ€è¦çš„é€»è¾‘ã€‚é‚£åˆ°åº•æœ‰å“ªäº›é€»è¾‘æ˜¯æ¯ä¸€ä¸ªContaineréƒ½éœ€è¦åšçš„å‘¢ï¼Ÿå…³é—­Appearanceå’ŒRotationç›¸å…³æ–¹æ³•çš„è‡ªåŠ¨ä¼ é€’ï¼›å½“Containerçš„Appearanceå’ŒRotationç›¸å…³æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œéœ€è¦å°†æ–¹æ³•ä¼ é€’ç»™ç›¸å…³çš„Child View Controllerï¼›ä»¥åŠå½“å‰Containeræ˜¯å¦æ”¯æŒæ—‹è½¬çš„å†³ç­–é€»è¾‘ç­‰ã€‚ä¸‹é¢ä¸ºä¸€ä¸ªå®¹å™¨åŸºç±»çš„ç¤ºèŒƒ:</p>

<pre><code>#import "ContainerBaseController.h"

&lt;a href='https://github.com/implementation' class='user-mention'&gt;@implementation&lt;/a&gt; ContainerBaseController

#pragma mark -
#pragma mark Overrides
//NS_DEPRECATED_IOS(5_0,6_0)
- (BOOL)automaticallyForwardAppearanceAndRotationMethodsToChildViewControllers{
return NO;
}

//NS_AVAILABLE_IOS(6_0)
- (BOOL)shouldAutomaticallyForwardAppearanceMethods{
    return NO;
}

//NS_AVAILABLE_IOS(6_0)
- (BOOL)shouldAutomaticallyForwardRotationMethods{
return NO;
}

- (void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];

    NSArray *viewControllers = [self childViewControllersWithAppearanceCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController beginAppearanceTransition:YES animated:animated];
    }
}

- (void)viewDidAppear:(BOOL)animated{
    [super viewDidAppear:animated];

    NSArray *viewControllers = [self childViewControllersWithAppearanceCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController endAppearanceTransition];
    }
}

- (void)viewWillDisappear:(BOOL)animated{
    [super viewWillDisappear:animated];

    NSArray *viewControllers = [self childViewControllersWithAppearanceCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController beginAppearanceTransition:NO animated:animated];
    }
}

- (void)viewDidDisappear:(BOOL)animated{
    [super viewDidDisappear:animated];

    NSArray *viewControllers = [self childViewControllersWithAppearanceCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController endAppearanceTransition];
    }
}


- (void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration{
    [super willRotateToInterfaceOrientation:toInterfaceOrientation duration:duration];

    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController willRotateToInterfaceOrientation:toInterfaceOrientation duration:duration];

}
}

- (void)willAnimateRotationToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration{
    [super willAnimateRotationToInterfaceOrientation:toInterfaceOrientation duration:duration];

    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
            [viewController willAnimateRotationToInterfaceOrientation:toInterfaceOrientation duration:duration];
    }
}

- (void)didRotateFromInterfaceOrientation:(UIInterfaceOrientation)fromInterfaceOrientation{
    [super didRotateFromInterfaceOrientation:fromInterfaceOrientation];

    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        [viewController didRotateFromInterfaceOrientation:fromInterfaceOrientation];
    }
}

/*
 NS_AVAILABLE_IOS(6_0) 
 å‘ä¸‹æŸ¥çœ‹å’Œæ—‹è½¬ç›¸å…³çš„ChildViewControllerçš„shouldAutorotateçš„å€¼
 åªæœ‰æ‰€æœ‰ç›¸å…³çš„å­VCéƒ½æ”¯æŒAutorotateï¼Œæ‰è¿”å›YES
 */
- (BOOL)shouldAutorotate{
    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    BOOL shouldAutorotate = YES;
    for (UIViewController *viewController in viewControllers) {
        shouldAutorotate = shouldAutorotate &amp;&amp;  [viewController shouldAutorotate];
    }

    return shouldAutorotate;
}

/*
 NS_AVAILABLE_IOS(6_0) 
 æ­¤æ–¹æ³•ä¼šåœ¨è®¾å¤‡æ—‹è½¬ä¸”shouldAutorotateè¿”å›YESçš„æ—¶å€™æ‰ä¼šè¢«è§¦å‘
 æ ¹æ®å¯¹åº”çš„æ‰€æœ‰æ”¯æŒçš„å–å‘æ¥å†³å®šæ˜¯å¦éœ€è¦æ—‹è½¬
 ä½œä¸ºå®¹å™¨ï¼Œæ”¯æŒçš„å–å‘è¿˜å†³å®šäºè‡ªå·±çš„ç›¸å…³å­ViewControllers
 */
- (NSUInteger)supportedInterfaceOrientations{
    NSUInteger supportedInterfaceOrientations = UIInterfaceOrientationMaskAll;

    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
        supportedInterfaceOrientations = supportedInterfaceOrientations &amp; [viewController supportedInterfaceOrientations];
    }

    return supportedInterfaceOrientations;
}


/*
 NS_DEPRECATED_IOS(2_0, 6_0) 6.0ä»¥ä¸‹ï¼Œè®¾å¤‡æ—‹è½¬æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨
 ç”¨æ¥å†³å®šæ˜¯å¦è¦æ—‹è½¬
 */
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation{
    BOOL shouldAutorotate = YES;
    NSArray *viewControllers = [self childViewControllersWithRotationCallbackAutoForward];
    for (UIViewController *viewController in viewControllers) {
    shouldAutorotate = shouldAutorotate &amp;&amp;  [viewController shouldAutorotateToInterfaceOrientation:toInterfaceOrientation];
    }
    return shouldAutorotate;
}

#pragma mark -
#pragma mark ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨éœ€è¦çš„æƒ…å†µä¸‹ç»™åŸºç±»è¦†ç›–ç”¨çš„ï¼Œæ¯•ç«Ÿä¸æ˜¯æ‰€æœ‰çš„å®¹å™¨éƒ½éœ€è¦å°†ç›¸å…³æ–¹æ³•ä¼ é€’ç»™æ‰€æœ‰çš„childViewControllers
- (NSArray *)childViewControllersWithAppearanceCallbackAutoForward{
    return self.childViewControllers;
}

- (NSArray *)childViewControllersWithRotationCallbackAutoForward{
    return self.childViewControllers;
}

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;
</code></pre>

<h3>äº”.åˆ›å»ºè‡ªå·±çš„Container</h3>

<h4>è®¾è®¡è¦ç‚¹</h4>

<p>åˆ›å»ºä¸€ä¸ªContainerï¼Œé¦–å…ˆä½ å¾—è®¾è®¡å¥½Container View Controllerçš„è¡Œä¸ºå’Œå…¬å¼€çš„APIï¼Œä½ å¯ä»¥å¥½å¥½å‚è€ƒUIKitä¸­è‡ªå¸¦çš„ä¸€äº›Containerçš„è®¾è®¡é£æ ¼ï¼Œæ¯”å¦‚UINaivgationControllerå°±æ˜¯ç®¡ç†ç€ä¸€ç»„Content View Controllerçš„å †æ ˆçš„Container,ä¸”æ­£åœ¨æ˜¾ç¤ºçš„æ˜¯æ ˆé¡¶çš„View Controllerã€‚</p>

<p>ä¸»è¦æ¥å£æœ‰View Controllerçš„æ¨å…¥ï¼Œæ­¤è¿‡ç¨‹ä¸­viewControllerä¼šå’ŒnavigationControllerå»ºç«‹çˆ¶å­å…³ç³»ï¼Œå¹¶å°†viewControlleræ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœanimatedæ˜¯YESçš„è¯ï¼Œåˆ™ä¼šæœ‰è¿‡åœºåŠ¨ç”»ï¼š</p>

<pre><code>- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated
</code></pre>

<p>popæ“ä½œï¼Œç§»é™¤æ ˆé¡¶çš„å†…å®¹ï¼Œä¼šè§£é™¤å’ŒnavigationControllerçš„çˆ¶å­å…³ç³»ï¼š</p>

<pre><code>- (UIViewController *)popViewControllerAnimated:(BOOL)animated;
</code></pre>

<p>å½“ç„¶å…³äºpopè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¾¿æ·æ¥å£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>

<p>å¦å¤–éœ€è¦æä¾›ä¸€äº›å¿«æ·çš„æ¥å£æ–¹ä¾¿<strong>è·å–ç‰¹å®šçš„Child View Controller</strong>ï¼Œæ¯”å¦‚<code>topViewController</code>å¯ä»¥è·å–æ ˆé¡¶çš„View Controllerã€‚</p>

<p>å¦å¤–å¦‚æœ‰å¿…è¦ï¼ŒContainerè¿˜éœ€è¦ç•™æœ‰<strong>delegateæ¥å£</strong>ï¼Œä¾¿äºé€šçŸ¥å¤–é¢Containerçš„ç›¸å…³è¡Œä¸ºé˜¶æ®µï¼Œä¾¿äºå¤–éƒ¨åšå‡ºç›¸å…³æ“ä½œï¼Œæ¯”å¦‚UINaivgationControllerå°±ä¼šåœ¨å³å°†è¦pushä¸€ä¸ªæ–°çš„View Controllerï¼Œå·²ç»pushäº†ä¸€ä¸ªæ–°çš„View Controllerç­‰æ—¶æœºç•™æœ‰delegateæ–¹æ³•ã€‚</p>

<p>è¿˜æœ‰ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜å°±æ˜¯ç›´æ¥æˆ–è€…é—´æ¥çš„Child View Controllerå¦‚ä½•å¿«é€Ÿçš„<strong>æ£€ç´¢</strong>åˆ°ç›¸åº”çš„Containerå‘¢ï¼Ÿä¸€èˆ¬Containeråœ¨å®ç°çš„æ—¶å€™å°±éœ€è¦è€ƒè™‘æ­¤é—®é¢˜å¹¶æä¾›ç›¸åº”çš„æ¥å£ï¼Œå®ç°çš„æ–¹æ³•ä¸€èˆ¬å°±æ˜¯å®ç°ä¸€ä¸ªUIViewControllerçš„Categoryï¼Œæ¯”å¦‚UINavigationControllerï¼Œåœ¨æŸä¸ªView Controllerä¸­è®¿é—®å…¶navigationControllerå±æ€§ï¼Œä¼šå‘ä¸Šéå†ï¼Œç›´åˆ°æ‰¾åˆ°æœ€è¿‘çš„ç±»å‹ä¸ºUINavigationControllerçš„ç¥–å…ˆï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¸ºnilï¼š</p>

<pre><code>&lt;a href='https://github.com/interface' class='user-mention'&gt;@interface&lt;/a&gt; UIViewController (UINavigationControllerItem)
...
&lt;a href='https://github.com/property' class='user-mention'&gt;@property&lt;/a&gt;(nonatomic,readonly,retain) UINavigationController *navigationController;

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;
</code></pre>

<h4>å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡æ€çª—å£Container</h4>

<p>æ¨¡æ€å±•ç¤º åˆ™è‡³å°‘å­˜åœ¨presentï¼Œdismissçš„æ¥å£ï¼Œä»¥åŠè·å–æ¨¡æ€View Controllerçš„å±æ€§</p>

<pre><code>#import &lt;UIKit/UIKit.h&gt;
#import "ContainerBaseController.h"

&lt;a href='https://github.com/interface' class='user-mention'&gt;@interface&lt;/a&gt; SimpleModalContainerController : ContainerBaseController

&lt;a href='https://github.com/property' class='user-mention'&gt;@property&lt;/a&gt; (nonatomic, readonly) UIViewController *simpleModalViewController;

- (void)presentSimpleModalViewController:(UIViewController *)viewControllerToPresent
                            animated:(BOOL)animated;

- (void)dismissSimpleModalViewControllerAnimated:(BOOL)animated;

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;

//å®ç°å¦‚ä¸‹
#import "SimpleModalContainerController.h"

&lt;a href='https://github.com/interface' class='user-mention'&gt;@interface&lt;/a&gt; SimpleModalContainerController ()
&lt;a href='https://github.com/property' class='user-mention'&gt;@property&lt;/a&gt; (nonatomic, readwrite) UIViewController *simpleModalViewController;
&lt;a href='https://github.com/property' class='user-mention'&gt;@property&lt;/a&gt; (nonatomic, strong) UIButton *backgroundButton;
&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;

&lt;a href='https://github.com/implementation' class='user-mention'&gt;@implementation&lt;/a&gt; SimpleModalContainerController

- (void)buttonTapped:(id)sender{
    [self dismissSimpleModalViewControllerAnimated:YES];
}

- (UIButton *)backgroundButton{
    if (!_backgroundButton) {
        _backgroundButton = [UIButton buttonWithType:UIButtonTypeCustom];
        _backgroundButton.backgroundColor = [UIColor blackColor];
        _backgroundButton.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
        _backgroundButton.alpha = 0.3;
        [_backgroundButton addTarget:self action:&lt;a href='https://github.com/selector' class='user-mention'&gt;@selector&lt;/a&gt;(buttonTapped:) forControlEvents:UIControlEventTouchUpInside];

    }
    _backgroundButton.frame = self.view.bounds;
    return _backgroundButton;
}

- (void)presentSimpleModalViewController:(UIViewController *)viewControllerToPresent
                            animated:(BOOL)animated{
    if (!self.simpleModalViewController &amp;&amp; viewControllerToPresent) {
        self.simpleModalViewController = viewControllerToPresent;

        [self addChildViewController:viewControllerToPresent];

        [viewControllerToPresent beginAppearanceTransition:YES animated:animated];

        [self.view addSubview:self.backgroundButton];

        viewControllerToPresent.view.center = CGPointMake(CGRectGetWidth(self.view.bounds) / 2.0, CGRectGetHeight(self.view.bounds) / 2.0);
        [self.view addSubview:viewControllerToPresent.view];

        if (animated) {
            viewControllerToPresent.view.alpha = 0;
            self.backgroundButton.alpha = 0;

            [UIView animateWithDuration:0.3 animations:^{
                viewControllerToPresent.view.alpha = 1;
                self.backgroundButton.alpha = 0.3;
            } completion:^(BOOL finished) {
                [viewControllerToPresent endAppearanceTransition];
                [viewControllerToPresent didMoveToParentViewController:self];
            }];
        } else {
            self.backgroundButton.alpha = 0.3;
            [viewControllerToPresent endAppearanceTransition];
            [viewControllerToPresent didMoveToParentViewController:self];
        }

    }
}

- (void)dismissSimpleModalViewControllerAnimated:(BOOL)animated{
    if (self.simpleModalViewController) {
        [self.simpleModalViewController willMoveToParentViewController:nil];
        [self.simpleModalViewController beginAppearanceTransition:NO animated:animated];

        if (animated) {
            [UIView animateWithDuration:0.3 animations:^{
                self.backgroundButton.alpha = 0;
                self.simpleModalViewController.view.alpha = 0 ;
            } completion:^(BOOL finished) {
                [self.backgroundButton removeFromSuperview];

                [self.simpleModalViewController.view removeFromSuperview];
                self.simpleModalViewController.view.alpha = 1.0;
                [self.simpleModalViewController endAppearanceTransition];
                [self.simpleModalViewController removeFromParentViewController];
                self.simpleModalViewController = nil;
            }];
        } else {
            [self.backgroundButton removeFromSuperview];

            [self.simpleModalViewController.view removeFromSuperview];
            self.simpleModalViewController.view.alpha = 1.0;
            [self.simpleModalViewController endAppearanceTransition];
            [self.simpleModalViewController removeFromParentViewController];
            self.simpleModalViewController = nil;
        }
    }
}

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;
</code></pre>

<p>UIViewControllerçš„Categoryç”¨äºChild View Controller è·å–ä¸Šå±‚çš„SimpleModalContainerController</p>

<pre><code>&lt;a href='https://github.com/interface' class='user-mention'&gt;@interface&lt;/a&gt; UIViewController (SimpleModalContainerController)

&lt;a href='https://github.com/property' class='user-mention'&gt;@property&lt;/a&gt; (nonatomic, readonly) SimpleModalContainerController *simpleModalContainerController;

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;

&lt;a href='https://github.com/implementation' class='user-mention'&gt;@implementation&lt;/a&gt; UIViewController (SimpleModalContainerController)

- (SimpleModalContainerController *)simpleModalContainerController{
    for (UIViewController *viewController = self.parentViewController; viewController != nil; viewController = viewController.parentViewController) {
        if ([viewController isKindOfClass:[SimpleModalContainerController class]]) {
            return (SimpleModalContainerController *)viewController;
        }
    }
    return nil;
}

&lt;a href='https://github.com/end' class='user-mention'&gt;@end&lt;/a&gt;
</code></pre>

</section>
<section class="meta">
<span class="author">
  <a href="http://geeklu.com">guodong.j</a>
</span>
<span class="time">
  /
  <time datetime="2014-05-08">2014-05-08</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/jinguodong-blog/categories/#programming" title="programming">programming</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/jinguodong-blog/tags/#objc" title="objc">objc</a>&nbsp;
  
  <a href="/jinguodong-blog/tags/#container" title="container">container</a>&nbsp;
  
</span>

</section>
<section class="comment">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jinguodong'; // required: replace example with your forum shortname
    var disqus_url = '/jinguodong-blog/2014/05/custom-container-view-controller/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = '/jinguodong-blog/2014/05/facebook-pop-usage/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Copyright 2014 - 2015 by <a href="http://jinguodong.github.com/jinguodong-blog/about/">JinGuodong</a> | <span class="label label-info">2015-02-01 23:22:08 ÖĞ¹ú±ê×¼Ê±¼ä</span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-57094722-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
